{"version":3,"file":"PopoverHelper.js","sourceRoot":"","sources":["../../../../../../src/services/PopoverHelper.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,UAAU,EAAE,eAAe,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAC,MAAM,kBAAkB,CAAC;AACjF,OAAO,EAAC,SAAS,EAAC,MAAM,gBAAgB,CAAC;AAEzC,MAAM,OAAO,aAAa;EAA1B;IAGU,qBAAgB,GAAG,IAAI,CAAC;IACf,gCAA2B,GAAG,CAAC,CAAC;EAsEnD,CAAC;EApEQ,OAAO,CAAC,SAAsB,EAAE,QAAqB,EAAE,SAAiB;IAC7E,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;IACjC,IAAI,CAAC,IAAI,CAAC,gBAAgB,IAAI,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC,EAAE;MAC7D,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;KAC7C;IACD,MAAM,QAAQ,GAAG,GAAG,EAAE;MACpB,eAAe,CAAC,SAAS,EAAE,QAAQ,EAAE;QACnC,QAAQ,EAAE,OAAO;QACjB,SAAS,EAAE,QAAQ;QACnB,UAAU,EAAE;UACV,MAAM,CAAC,IAAI,CAAC,2BAA2B,CAAC;UACxC,IAAI,CAAC;YACH,kBAAkB,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC;YACrC,gBAAgB,EAAE,kBAAkB;YACpC,QAAQ,EAAE,QAAQ,CAAC,IAAI;YACvB,OAAO,EAAE,CAAC;WACX,CAAC;UACF,IAAI,CAAC;YACH,KAAK,EAAE,CAAC,EAAC,KAAK,EAAE,QAAQ,EAAE,eAAe,EAAC,EAAE,EAAE;cAC5C,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,KAAK,EAAE;gBACrC,KAAK,EAAE,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,IAAI;gBACnC,SAAS,EAAE,OAAO,eAAe,OAAO,SAAS,GAAG;eACrD,CAAC,CAAC;YACL,CAAC;YACD,OAAO,EAAE,CAAC;YACV,QAAQ,EAAE,QAAQ,CAAC,IAAI;WACxB,CAAC;SACH;OACF,CAAC,CAAC,IAAI,CAAC,CAAC,gBAAgB,EAAE,EAAE;QAC3B,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE;UAC5B,GAAG,EAAE,GAAG,gBAAgB,CAAC,CAAC,IAAI;UAC9B,IAAI,EAAE,GAAG,gBAAgB,CAAC,CAAC,IAAI;SAChC,CAAC,CAAC;MACL,CAAC,CAAC,CAAC;IACL,CAAC,CAAC;IAEF,IAAI,CAAC,cAAc,GAAG,UAAU,CAC9B,SAAS,EACT,QAAQ,EACR,QAAQ,CACT,CAAC;EAEJ,CAAC;EAEM,UAAU;IACf,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;EAC/C,CAAC;EAEO,iBAAiB,CAAC,OAAoB;IAC5C,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC;EAC3D,CAAC;EAEO,gBAAgB,CAAC,OAAoB;IAC3C,OAAO,SAAS,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;EACjD,CAAC;EAEO,kBAAkB,CAAC,OAAoB;IAC7C,OAAO,CACL,CAAC,OAAO,WAAW,KAAK,WAAW;MACjC,OAAO,WAAW,CAAC,SAAS,KAAK,QAAQ;MACzC,SAAS,IAAI,WAAW,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,SAAS,CAAC,QAAQ,CAAC,eAAe,CAAC,CAAC,CACxF,CAAC;EACJ,CAAC;EAEO,cAAc,CAAC,SAAsB;IAC3C,OAAQ,SAAS,CAAC,WAAW,EAAiB,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;EAC5E,CAAC;CAEF","sourcesContent":["import {autoUpdate, computePosition, flip, offset, size} from '@floating-ui/dom';\nimport {isDefined} from '../utils/utils';\n\nexport class PopoverHelper {\n\n  private stopAutoUpdate: () => void;\n  private popoverSupported = true;\n  private readonly DISTANCE_REFERENCE_FLOATING = 4;\n\n  public connect(reference: HTMLElement, floating: HTMLElement, maxHeight: string) {\n    this.setPopoverSupport(floating);\n    if (!this.popoverSupported && this.isPopoverInModal(floating)) {\n      floating.classList.add('_popover-in-modal');\n    }\n    const callback = () => {\n      computePosition(reference, floating, {\n        strategy: 'fixed',\n        placement: 'bottom',\n        middleware: [\n          offset(this.DISTANCE_REFERENCE_FLOATING),\n          flip({\n            fallbackPlacements: ['top', 'bottom'],\n            fallbackStrategy: 'initialPlacement',\n            boundary: document.body,\n            padding: 5\n          }),\n          size({\n            apply: ({rects, elements, availableHeight}) => {\n              Object.assign(elements.floating.style, {\n                width: `${rects.reference.width}px`,\n                maxHeight: `min(${availableHeight}px, ${maxHeight})`\n              });\n            },\n            padding: 5,\n            boundary: document.body\n          })\n        ]\n      }).then((computedPosition) => {\n        Object.assign(floating.style, {\n          top: `${computedPosition.y}px`,\n          left: `${computedPosition.x}px`\n        });\n      });\n    };\n\n    this.stopAutoUpdate = autoUpdate(\n      reference,\n      floating,\n      callback,\n    );\n\n  }\n\n  public disconnect() {\n    this.stopAutoUpdate && this.stopAutoUpdate();\n  }\n\n  private setPopoverSupport(element: HTMLElement): void {\n    this.popoverSupported = this.isPopoverSupported(element);\n  }\n\n  private isPopoverInModal(element: HTMLElement) {\n    return isDefined(this.getModalParent(element));\n  }\n\n  private isPopoverSupported(element: HTMLElement): boolean {\n    return (\n      (typeof HTMLElement !== 'undefined' &&\n        typeof HTMLElement.prototype === 'object' &&\n        'popover' in HTMLElement.prototype) && (!element.classList.contains(':popover-open'))\n    );\n  }\n\n  private getModalParent(reference: HTMLElement) {\n    return (reference.getRootNode() as ShadowRoot).host.closest('soul-modal');\n  }\n\n}\n"]}